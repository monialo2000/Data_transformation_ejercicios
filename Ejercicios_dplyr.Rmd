---
title: "Ejercicios_Data_Transformation"
output:
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
library(tidyverse)
library(datos)
```

# Dplyr
dplyr trabaja con %>% (pipes), y requiere datos en formato tidy para explotar su potencial.
x %>% f(y) se convierte en f(x, y)

## Operadores booleanos para hacer selección, filtrado, etc.
Operadores Lógicos y Booleanos para usar con filter()
```
<     <=    is.na()     %in%    |    xor()
>     >=    !is.na()    ==      !     &

near() para números decimales
between(minimo, maximo)
si se pone más de una condición separando por , funciona como un &
```

## funciones de ayuda para hacer selección:
```
contains(“ijk”)   # coincide con los nombres que contienen “ijk”
ends_with(“xyz”)  # coincide con los nombres que terminan con “xyz”
matches("(.)\\1") # selecciona variables que coinciden con una expresión regular. Esta caso: coincide con cualquier                         variable que contenga caracteres repetidos
:                 # por ejemplo  mpg:cyl     --> todas las columnas entre mpg y cyl
-                 # por ejemplo  -Species    --> todas las columnas menos Species
!                 # niega una selección Ejemplo select(!(name:mass))todas menos esas...
num_range(prefix, range) #selecciona todas las variables en un rango. Ejemplo select(num_range("wk", 10:15)) wk10,wk11..
one_of(…)
starts_with("abc") # coincide con los nombres que comienzan con “abc”. Ejemplo select(starts_with(c("Petal", "Sepal")))
everything()       # selecciona todas las variables
last_col()         # selecciona la ultima variable, 
all_of()           # ver en select
any_of()           # ver en select
where()            # ver en select-aplica una función a todas las variables y selecciona aquellas en q la fc devolvió TRUE
```


## Manipular casos

### Seleccionar casos:
devuelven un conjunto de filas
```{r filter}
filter(iris, Sepal.Length > 7) #selecciona las filas que cumplen la condición. Recordar == para igual
# filter() solo incluye filas donde la condición es TRUE; excluye tanto los valores FALSE como NA
# No puedes escribir filter(vuelos, mes == (11 | 12)) --> filter(vuelos, mes== 11 | mes == 12)
```

```{r distinct}
distinct(iris, Species)  #distinct(.data, ..., .keep_all = FALSE) remueve filas duplicadas ... columnas
        
```

```{r sample_frac}
sample_frac(iris, 0.5, replace = TRUE) #extrae la mitad de las filas al azar
```

```{r sample_n}
sample_n(iris, 10, replace = TRUE) #extrae n=10 filas del data.frame al azar
```

```{r slice}
slice(iris, 10:15) #Selecciona filas por posición. 
```
#¡¡¡¡PROBAR TOP_N CON GRUPOS!!!!!!!
```{r top_n}
top_n(iris, 5, Sepal.Width) # Selecciona y ordena las n entradas mas altas (por grupo si los datos están agrupados).
```

## Ordenar casos
arrange(.data, …) Ordena filas por valores de una columna (bajo a alto), usa con desc() para
ordenar de alto a bajo.

```{r arrange}
arrange(mtcars, mpg) #ASCENDENTE
arrange(mtcars, desc(mpg))  #DESCENDENTE
```

## Añadir casos:

```{r add_row}
#add_row(.data, ..., .before = NULL, .after = NULL)  Añade una o mas filas a un cuadro.  Idem add_case
add_row(faithful, eruptions = 1, waiting = 1)

#Otro
df <- tibble(x = 1:3, y = 3:1)
df %>% add_row(x = 4, y = 0, .before = 2) # aca se especifica dónde añadirla

# You can supply vectors, to add multiple rows (this isn't
# recommended because it's a bit hard to read)
df %>% add_row(x = 4:5, y = 0:-1)
df %>% add_row(x = 4)  # la variable que no se informa queda como missing value

```

## Manipular Variables

### Seleccionar variables:
devuelven un conjunto de columnas por nombre o funciones de ayuda
 
```{r select}
select(iris, Sepal.Length, Species)
select(iris, starts_with("Sepal"))

vars <- c("Sepal.Length", "Sepal.Width")
select(iris, all_of(vars))
select(iris, any_of(vars))  #da el mismo resultado que all_of?
iris %>% select(where(is.numeric))
select(vuelos, fecha_hora, tiempo_vuelo, everything()) # deja las 3 escritas adelante, pero muestra todas las variables
select(vuelos, fec_hor = fecha_hora, tiempo_vuelo)
```

```{r select_if()}
iris %>% select_if(is.numeric, tolower)
iris %>% select_all(toupper)
#select_at()
```
## Crea nuevas variables
```{r mutate}
mutate(mtcars, gpm = 1/mpg) #crea columna nueva
transmute(mtcars, gpm = 1/mpg) #crea columna nueva y todas las que esten nombradas en el transmute, las demas las elimina
```


```{r rename}
mtcars %>%
  select(!contains("ar") | starts_with("c")) %>%
  rename_with(toupper) #todo en mayúsculas
```


